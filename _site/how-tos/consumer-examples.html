<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Consumer Usage Examples</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div class="container">
        <header>
            <a href="/"> 
                <img src="/img/logo.svg" alt="Molecula Logo" class="logo">
            </a>
        </header>
        <main class="container__main">
            <!-- Left sidebar -->
            <aside class="container__left">
                <ul>
    
      
        <li><a href="/index.html">Home</a></li>
        
  
      
    
       
        <li><p>Tutorials</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/tutorials/getting-started.html">Getting Started</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Explanation</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/explanations/architecture.html">Architecture</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>How-Tos</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/how-tos/install-featurebase.html">Install FeatureBase</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Reference</a></li>
        
  
      
        <ul>
    
       
        <li><p>Interfaces</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/reference/apis.html">APIs</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Query Languages</a></li>
        
  
      
    
       
        <li><p>Operations</a></li>
        
  
      
    
       
        <li><p>Configuration</a></li>
        
  
      
    
      
        <li><a href="/reference/glossary.html">Glossary</a></li>
        
  
      
    
  </ul>

      
    
  </ul>

            </aside>
    
            <article class="container__middle">
                <h1>Consumer Usage Examples</h1>
                <section>
                  <p>Also refer to the <a href="/reference/ingester-configuration">ingester configuration reference</a> page for details on configuration flags for all consumers.</p>

<h1 id="molecula-consumer-binaries">Molecula consumer binaries</h1>

<!--
molecula-consumer-furan - customer-specific, deprecated
molecula-consumer-github - for internal benchmarking
-->

<h2 id="csv-consumer">CSV consumer</h2>

<h3 id="example-1-simple-ingest-internal-header-multiple-file-id-autogen">Example 1: Simple ingest, internal header, multiple-file, ID autogen</h3>

<p>Command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-csv <span class="se">\</span>
    <span class="nt">--batch-size</span><span class="o">=</span>10000 <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>csv-ingest-test <span class="se">\</span>
    <span class="nt">--files</span><span class="o">=</span>sample.csv,sample2.csv <span class="se">\</span>
    <span class="nt">--concurrency</span><span class="o">=</span>2
</code></pre></div></div>

<p>sample.csv:</p>

<pre><code class="language-csv">asset_tag__String,fan_time__RecordTime_2006-01-02,fan_val__String_F_YMD
ABCD,2019-01-02,70%
ABCD,2019-01-03,20%
BEDF,2019-01-02,70%
BEDF,2019-01-05,90%
ABCD,2019-01-30,40%
BEDF,2019-01-08,10%
BEDF,2019-01-08,20%
ABCD,2019-01-04,30%
</code></pre>

<p>Note the <em>Header Specification</em>:</p>

<p><code class="language-plaintext highlighter-rouge">asset_tag__String,fan_time__RecordTime_2006-01-02,fan_val__String_F_YMD</code></p>

<p>This specifies three fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">asset_tag</code>, a <code class="language-plaintext highlighter-rouge">String</code> field, …</li>
  <li><code class="language-plaintext highlighter-rouge">fan_time</code>, a <code class="language-plaintext highlighter-rouge">RecordTime</code> field, with timestamp layout format <code class="language-plaintext highlighter-rouge">2006-01-02</code> (according to go time)</li>
  <li><code class="language-plaintext highlighter-rouge">fan_val</code>, a <code class="language-plaintext highlighter-rouge">String</code> field, …</li>
</ul>

<!-- TODO explanation -->
<!-- TODO sample queries -->

<h3 id="example-2-simple-ingest-external-header">Example 2: Simple ingest, external header</h3>

<p>Command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-csv <span class="se">\</span>
    <span class="nt">--batch-size</span><span class="o">=</span>10000 <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--header</span><span class="o">=</span>asset_tag__String,fan_time__RecordTime_2006-01-02,fan_val__String_F_YMD <span class="se">\</span>
    <span class="nt">--ignore-header</span>
    <span class="nt">--index</span><span class="o">=</span>csv-ingest-test <span class="se">\</span>
    <span class="nt">--files</span><span class="o">=</span>sample.csv,sample2.csv <span class="se">\</span>
    <span class="nt">--concurrency</span><span class="o">=</span>2
</code></pre></div></div>

<p>sample.csv:</p>

<pre><code class="language-csv">asset_tag,fan_time,fan_val
ABCD,2019-01-02,70%
ABCD,2019-01-03,20%
BEDF,2019-01-02,70%
BEDF,2019-01-05,90%
ABCD,2019-01-30,40%
BEDF,2019-01-08,10%
BEDF,2019-01-08,20%
ABCD,2019-01-04,30%
</code></pre>

<p>Note that a header line is present in the csv file, however, we are ignoring it. The <em>Header specification</em>
is passed in the command line with <code class="language-plaintext highlighter-rouge">--header</code>.</p>

<h3 id="example-3-simple-ingest-over-tls">Example 3: Simple ingest over tls</h3>

<p>Command</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-csv <span class="se">\</span>
    <span class="nt">--pilosa-hosts</span><span class="o">=</span>https://localhost:10101
    <span class="nt">--tls</span>.certificate<span class="o">=</span>featurebase.local.crt <span class="se">\</span>
    <span class="nt">--tls</span>.key<span class="o">=</span>featurebase.local.key <span class="se">\</span>
    <span class="nt">--tls</span>.skip-verify <span class="se">\</span>
    <span class="nt">--batch-size</span><span class="o">=</span>10000 <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>csv-ingest-test <span class="se">\</span>
    <span class="nt">--files</span><span class="o">=</span>sample.csv <span class="se">\</span>
    <span class="nt">--concurrency</span><span class="o">=</span>2
</code></pre></div></div>

<p>Or, equivalently, with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-csv <span class="se">\</span>
    <span class="nt">--future</span>.rename <span class="se">\</span>
    <span class="nt">--featurebase-hosts</span><span class="o">=</span>https://localhost:10101
    <span class="nt">--tls</span>.certificate<span class="o">=</span>featurebase.local.crt <span class="se">\</span>
    <span class="nt">--tls</span>.key<span class="o">=</span>featurebase.local.key <span class="se">\</span>
    <span class="nt">--tls</span>.skip-verify <span class="se">\</span>
    <span class="nt">--batch-size</span><span class="o">=</span>10000 <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>csv-ingest-test <span class="se">\</span>
    <span class="nt">--files</span><span class="o">=</span>sample.csv <span class="se">\</span>
    <span class="nt">--concurrency</span><span class="o">=</span>2
</code></pre></div></div>

<p>Note that we provide tls configuration (<code class="language-plaintext highlighter-rouge">--tls.certificate</code> and <code class="language-plaintext highlighter-rouge">--tls.key</code>) to the command for securely
connecting to FeatureBase. The values for these parameters are the filenames for certificate and key that
correspond to the target FeatureBase instances. If verification of certificate is not desired
(especially for self-signed certificates), we need to include <code class="language-plaintext highlighter-rouge">--tls.skip-verify</code>. Since the default
bind point for FeatureBase hosts are HTTP, we provide the bind points using <code class="language-plaintext highlighter-rouge">--pilosa-hosts</code> (or,
<code class="language-plaintext highlighter-rouge">--featurebase-hosts</code> with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>).</p>

<h2 id="kafka-consumer">Kafka consumer</h2>

<p>The Kafka consumer requires:</p>
<ul>
  <li>A list of Kafka hosts</li>
  <li>A FeatureBase index name (<code class="language-plaintext highlighter-rouge">--index &lt;indexname&gt;</code>),</li>
  <li>Exactly one primary key method (<code class="language-plaintext highlighter-rouge">--primary-key-field &lt;fieldnames&gt;</code>, <code class="language-plaintext highlighter-rouge">--id-field &lt;fieldname&gt;</code> or <code class="language-plaintext highlighter-rouge">--auto-generate</code>),</li>
</ul>

<h3 id="example-1-minimal">Example 1: minimal</h3>

<!-- TODO -->

<p>Command:
<code class="language-plaintext highlighter-rouge">molecula-consumer-kafka </code></p>

<p>Data:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span></code></pre></div></div>

<h3 id="kafka-delete-consumer">Kafka delete consumer</h3>
<p>Configuration and usage for this consumer is identical to the Kafka consumer, with the exception of the <code class="language-plaintext highlighter-rouge">pilosa-grpc-hosts</code> (or <code class="language-plaintext highlighter-rouge">featurebase-grpc-hosts</code> with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>). Instead of inserting data into FeatureBase from the received messages, it deletes the corresponding data from FeatureBase. This provides delete capabilities using the same Kafka interface.</p>

<h2 id="kafka-static-consumer">Kafka static consumer</h2>
<p>Configuration and usage for this consumer is similar to the kafka consumer. It was developed for use in scenarios where Kafka is used without Confluent Schema Registry. In this case, the schema must be provided explicitly; the “static” in the consumer name refers to this “static schema”. For compatibility with complex JSON message formats, the schema is specified with a JSON document rather than the “header spec” used in other consumers.</p>

<h3 id="example-1-simple-ingest">Example 1: Simple ingest</h3>

<p>Command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-kafka-static <span class="se">\</span>
    <span class="nt">--kafka-hosts</span> <span class="s2">"localhost:9092"</span> <span class="se">\</span>
    <span class="nt">--index</span> kafka-test <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--topics</span> test-topic <span class="se">\</span>
    <span class="nt">--max-msgs</span> 10000 <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--external-generate</span> <span class="se">\</span>
    <span class="nt">--header</span> kafka-static-header-1.json
</code></pre></div></div>

<p>kafka-static-header-1.json:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int-featurebase-name"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"int-kafka-path"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string-featurebase-name"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"string-kafka-path"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Example Kafka message:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"int-kafka-path"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w">
    </span><span class="nl">"string-kafka-path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arbitraryString"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The header file specifies two fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">int-featurebase-name</code>, a FeatureBase field of type <code class="language-plaintext highlighter-rouge">int</code>, populated with the value from the <code class="language-plaintext highlighter-rouge">int-kafka-path</code> item in the Kafka message.</li>
  <li><code class="language-plaintext highlighter-rouge">string-featurebase-name</code>, a string-keyed FeatureBase field of type <code class="language-plaintext highlighter-rouge">set</code>, populated with the value from the <code class="language-plaintext highlighter-rouge">string-kafka-path</code> item in the Kafka message.</li>
</ul>

<!-- TODO explanation -->
<!-- TODO queries -->

<h3 id="example-2">Example 2:</h3>

<p>Command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-kafka-static <span class="se">\</span>
    <span class="nt">--kafka-hosts</span> <span class="s2">"localhost:9092"</span> <span class="se">\</span>
    <span class="nt">--index</span> kafka-test <span class="se">\</span>
    <span class="nt">--batch-size</span><span class="o">=</span>10000 <span class="se">\</span>
    <span class="nt">--topics</span> test-topic <span class="se">\</span>
    <span class="nt">--auto-generate</span> <span class="se">\</span>
    <span class="nt">--allow-missing-fields</span> <span class="se">\</span>
    <span class="nt">--header</span> kafka-static-header-2.json
</code></pre></div></div>

<p>kafka-static-header-2.json:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_ip"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"from_interface"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"ip"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"from_port"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"from_interface"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"port"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"to_ip"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"to_interface"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"ip"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"to_port"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"to_interface"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"port"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"event_time"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"event_time"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"severity"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"severity"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"set"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"bytes"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"protocol"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<!-- TODO more complex path selection -->
<!-- TODO more types and config options in header file -->

<p>Sample Kafka message:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"from_interface"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.203.33.18"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">38935</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"to_interface"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"203.77.221.220"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">5872</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"event_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-06-01T16:02:55Z06:00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UDP"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"severity"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">8593</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<!-- TODO queries -->

<h2 id="sql-consumer">SQL consumer</h2>

<h3 id="example-1">Example 1</h3>

<p>The <code class="language-plaintext highlighter-rouge">molecula-consumer-sql</code> examples use sample data represented by the following two tables.</p>

<p>Table: <code class="language-plaintext highlighter-rouge">assets</code></p>

<table>
  <thead>
    <tr>
      <th>asset_tag</th>
      <th>weight</th>
      <th>warehouse</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ABCD</td>
      <td>16</td>
      <td>US-EAST</td>
    </tr>
    <tr>
      <td>EFGH</td>
      <td>9</td>
      <td>US-WEST</td>
    </tr>
    <tr>
      <td>IJKL</td>
      <td>47</td>
      <td>US-WEST</td>
    </tr>
    <tr>
      <td>MNOP</td>
      <td>30</td>
      <td>US-EAST</td>
    </tr>
  </tbody>
</table>

<p>Table: <code class="language-plaintext highlighter-rouge">events</code></p>

<table>
  <thead>
    <tr>
      <th>pk</th>
      <th>asset_tag</th>
      <th>fan_time</th>
      <th>fan_vol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>aus-14</td>
      <td>ABCD</td>
      <td>2021-06-21</td>
      <td>90%</td>
    </tr>
    <tr>
      <td>aus-15</td>
      <td>EFGH</td>
      <td>2021-06-19</td>
      <td>10%</td>
    </tr>
    <tr>
      <td>aus-16</td>
      <td>ABCD</td>
      <td>2021-06-20</td>
      <td>60%</td>
    </tr>
    <tr>
      <td>den-11</td>
      <td>IJKL</td>
      <td>2021-06-19</td>
      <td>70%</td>
    </tr>
    <tr>
      <td>den-12</td>
      <td>MNOP</td>
      <td>2021-06-20</td>
      <td>90%</td>
    </tr>
    <tr>
      <td>nyc-78</td>
      <td>MNOP</td>
      <td>2021-06-21</td>
      <td>80%</td>
    </tr>
    <tr>
      <td>den-13</td>
      <td>MNOP</td>
      <td>2021-06-21</td>
      <td>80%</td>
    </tr>
    <tr>
      <td>nyc-79</td>
      <td>ABCD</td>
      <td>2021-06-21</td>
      <td>30%</td>
    </tr>
  </tbody>
</table>

<p>based on these CREATE TABLE statements:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`assets`</span> <span class="p">(</span>
    <span class="nv">`asset_tag`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span><span class="p">,</span>
    <span class="nv">`weight`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nv">`warehouse`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`asset_tag`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`events`</span> <span class="p">(</span>
    <span class="nv">`pk`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span><span class="p">,</span>
    <span class="nv">`asset_tag`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span><span class="p">,</span>
    <span class="nv">`fan_time`</span> <span class="nb">date</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`fan_vol`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`pk`</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>This example creates an index based directly on the <code class="language-plaintext highlighter-rouge">assets</code> table:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--pilosa-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>asset_list <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'asset_tag'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT asset_tag as asset_tag__String, weight as weight__Int, warehouse as warehouse__String FROM assets'</span>
</code></pre></div></div>

<p>Or, equivalently, with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--future</span>.rename <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--featurebase-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>asset_list <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'asset_tag'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT asset_tag as asset_tag__String, weight as weight__Int, warehouse as warehouse__String FROM assets'</span>
</code></pre></div></div>

<p>It’s important to understand that the data to be indexed does not necessarily align to a table in the source database. Rather, it aligns with the results of the SQL query specified in the <code class="language-plaintext highlighter-rouge">--row-expr</code> argument. In other words, you can use any SQL functionality to join or modify data, and the result of that query is what the consumer considers to be the source data.</p>

<p>So for example, you might want to ingest the <code class="language-plaintext highlighter-rouge">events</code> table, but treat the <code class="language-plaintext highlighter-rouge">fan_vol</code> field as an integer instead of a string. In that case, you can simply use SQL functions to convert that string field to an integer-ready value:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--pilosa-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>event_list <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'pk'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT pk as pk__String, asset_tag as asset_tag__String, fan_time as `fan_time__Timestamp_s_2006-01-02`, SUBSTRING(fan_vol, 1, CHAR_LENGTH(fan_vol)-1) as fan_vol__Int FROM events'</span>
</code></pre></div></div>

<p>Or, equivalently, with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--future</span>.rename <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--featurebase-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>event_list <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'pk'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT pk as pk__String, asset_tag as asset_tag__String, fan_time as `fan_time__Timestamp_s_2006-01-02`, SUBSTRING(fan_vol, 1, CHAR_LENGTH(fan_vol)-1) as fan_vol__Int FROM events'</span>
</code></pre></div></div>

<p>This example illustrates using a SQL query which joins data from both tables into a single FeatureBase index which contains the event data along with the <code class="language-plaintext highlighter-rouge">weight</code> of the relative <code class="language-plaintext highlighter-rouge">asset_tag</code>. It also creates a new field completely, called <code class="language-plaintext highlighter-rouge">locale</code>, based on the first three characters of the <code class="language-plaintext highlighter-rouge">pk</code> field:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--pilosa-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>events_plus_weight <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'pk'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT events.pk as pk__String, events.asset_tag as asset_tag__String, assets.weight as weight__Int, SUBSTRING(events.pk, 1, 3) as locale__String FROM events INNER JOIN assets on assets.asset_tag = events.asset_tag'</span>
</code></pre></div></div>

<p>Or, equivalently, with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--future</span>.rename <span class="se">\</span>
    <span class="nt">--driver</span> mysql <span class="se">\</span>
    <span class="nt">--connection-string</span> <span class="s1">'username:password@(127.0.0.1:3306)/dbname'</span> <span class="se">\</span>
    <span class="nt">--featurebase-hosts</span> localhost:10101 <span class="se">\</span>
    <span class="nt">--batch-size</span> 10000 <span class="se">\</span>
    <span class="nt">--index</span><span class="o">=</span>events_plus_weight <span class="se">\</span>
    <span class="nt">--primary-key-fields</span> <span class="s1">'pk'</span> <span class="se">\</span>
    <span class="nt">--row-expr</span> <span class="s1">'SELECT events.pk as pk__String, events.asset_tag as asset_tag__String, assets.weight as weight__Int, SUBSTRING(events.pk, 1, 3) as locale__String FROM events INNER JOIN assets on assets.asset_tag = events.asset_tag'</span>
</code></pre></div></div>

<!-- TODO
## bigquery
-->

                </section>
            </article>
    
            <!-- Right sidebar -->
            <nav class="container__right">
                <div>Applies to</div>

                <span>Please <a href="https://github.com/molecula/documentation/edit/gh-pages/how-tos/consumer-examples.md">help improve this article</a>.</span>

                <div>
                    <span>
                        Modified: 
                    </span>
                </div>

                <div>Feedback?</div>
            </nav>
        </main>
        <footer>
            <p> &copy; 2022 Molecula Corp.</p>
        </footer>
    </div>
  </body>
</html>
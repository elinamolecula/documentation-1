<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How To Enable Mutual TLS</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div class="container">
        <header>
            <a href="/"> 
                <img src="/img/logo.svg" alt="Molecula Logo" class="logo">
            </a>
        </header>
        <main class="container__main">
            <!-- Left sidebar -->
            <aside class="container__left">
                <ul>
    
      
        <li><a href="/index.html">Home</a></li>
        
  
      
    
       
        <li><p>Tutorials</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/tutorials/getting-started.html">Getting Started</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Explanation</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/explanations/architecture.html">Architecture</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>How-Tos</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/how-tos/install-featurebase.html">Install FeatureBase</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Reference</a></li>
        
  
      
        <ul>
    
       
        <li><p>Interfaces</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/reference/apis.html">APIs</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Query Languages</a></li>
        
  
      
    
       
        <li><p>Operations</a></li>
        
  
      
    
       
        <li><p>Configuration</a></li>
        
  
      
    
      
        <li><a href="/reference/glossary.html">Glossary</a></li>
        
  
      
    
  </ul>

      
    
  </ul>

            </aside>
    
            <article class="container__middle">
                <h1>How To Enable Mutual TLS</h1>
                <section>
                  <h2 id="tlsencryption">TLS/Encryption</h2>

<p>FeatureBase supports Mutual TLS, which allows both the client and server to cryptographically verify each other and establish an encrypted connection. To enable encryption on every connection, FeatureBase is configured with a PEM-encoded TLS keypair. In addition, nodes in a FeatureBase cluster internally communicate over the Memberlist protocol, which can be configured with a shared 32-bit key to enable AES-256 symmetric encryption within the cluster.</p>

<h3 id="generating-keys">Generating keys</h3>

<p>In order to enable TLS, you will need to generate a TLS keypair for FeatureBase. For testing in a development environment, we recommend using <a href="https://github.com/square/certstrap">Certstrap</a> to generate the necessary keys. <strong>We do not recommend certstrap for production usage.</strong> Setting up a secure public key infrastructure is outside of the scope of this document, but the following examples will use Certstrap to bootstrap a certificate authority and create signed TLS keypairs for the purpose of demonstration.</p>

<p>Create a root CA for testing purposes:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    certstrap init <span class="nt">--common-name</span> <span class="s2">"auth.mybusiness.com"</span>
</code></pre></div></div>

<p>Create and sign a keypair for FeatureBase:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    certstrap request-cert <span class="nt">--common-name</span> <span class="s2">"featurebase.mybusiness.com"</span>
    certstrap sign featurebase.mybusiness.com <span class="nt">--CA</span> auth.mybusiness.com
</code></pre></div></div>

<p>Create a 32-bit key to encrypt Memberlist (gossip) communication:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nb">head</span> <span class="nt">-c</span> 32 /dev/random <span class="o">&gt;</span> out/gossip.key
</code></pre></div></div>

<p>After running the previous commands, you should have the following files in a directory called “out”:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    auth.mybusiness.com.crl
    auth.mybusiness.com.crt
    auth.mybusiness.com.key
    featurebase.mybusiness.com.crt
    featurebase.mybusiness.com.csr
    featurebase.mybusiness.com.key
    gossip.key
</code></pre></div></div>

<h3 id="configuring-featurebase">Configuring FeatureBase</h3>

<p>FeatureBase must be configured with the certificate and private key using environment variables, a configuration file, or command line parameters. Internal etcd cluster communication does not currently support TLS, but that’s coming soon.</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nn">[tls]</span>
      <span class="py">certificate</span> <span class="p">=</span> <span class="s">"/path/to/featurebase.mybusiness.com.crt"</span>
      <span class="py">key</span> <span class="p">=</span> <span class="s">"/path/to/featurebase.mybusiness.com.key"</span>
</code></pre></div></div>

<p>You must also update your bind configuration to use the <code class="language-plaintext highlighter-rouge">https</code> scheme.</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">bind</span> <span class="p">=</span> <span class="s">"https://YOUR-DOMAIN-HERE:10101"</span>
<span class="py">bind-grpc</span> <span class="p">=</span> <span class="s">"https://YOUR-DOMAIN-HERE:20101"</span>
</code></pre></div></div>

                </section>
            </article>
    
            <!-- Right sidebar -->
            <nav class="container__right">
                <div>Applies to</div>

                <span>Please <a href="https://github.com/molecula/documentation/edit/gh-pages/how-tos/enable-mutual-tls.md">help improve this article</a>.</span>

                <div>
                    <span>
                        Modified: 
                    </span>
                </div>

                <div>Feedback?</div>
            </nav>
        </main>
        <footer>
            <p> &copy; 2022 Molecula Corp.</p>
        </footer>
    </div>
  </body>
</html>
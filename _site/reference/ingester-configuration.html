<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ingester Configuration</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div class="container">
        <header>
            <a href="/"> 
                <img src="/img/logo.svg" alt="Molecula Logo" class="logo">
            </a>
        </header>
        <main class="container__main">
            <!-- Left sidebar -->
            <aside class="container__left">
                <ul>
    
      
        <li><a href="/index.html">Home</a></li>
        
  
      
    
       
        <li><p>Tutorials</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/tutorials/getting-started.html">Getting Started</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Explanation</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/explanations/architecture.html">Architecture</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>How-Tos</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/how-tos/install-featurebase.html">Install FeatureBase</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Reference</a></li>
        
  
      
        <ul>
    
       
        <li><p>Interfaces</a></li>
        
  
      
        <ul>
    
      
        <li><a href="/reference/apis.html">APIs</a></li>
        
  
      
    
  </ul>

      
    
       
        <li><p>Query Languages</a></li>
        
  
      
    
       
        <li><p>Operations</a></li>
        
  
      
    
       
        <li><p>Configuration</a></li>
        
  
      
    
      
        <li><a href="/reference/glossary.html">Glossary</a></li>
        
  
      
    
  </ul>

      
    
  </ul>

            </aside>
    
            <article class="container__middle">
                <h1>Ingester Configuration</h1>
                <section>
                  <p>Also see the <a href="/how-tos/consumer-usage-examples">consumer examples</a> page for usage examples with corresponding data and configuration files <!-- TODO and queries -->.</p>

<h2 id="authentication">Authentication</h2>
<p>When authentication is enabled, a valid JWT must be passed to the <code class="language-plaintext highlighter-rouge">auth-token</code> flag for any ingester. The token may be obtained by following these <a href="/how-tos/enable-auth#how-to-get-auth-token">instructions</a>. Only users with admin permissions will be able to perform ingest.</p>

<h2 id="kafka-ingester">Kafka Ingester</h2>

<p>The Kafka ingester reads Avro-encoded records from a Kafka topic, uses the Confluent schema registry to decode them, and ingests the data into Molecula.</p>

<p>Use <code class="language-plaintext highlighter-rouge">molecula-consumer-kafka -h </code>to list all available flags. Each flag is also available as an environment variable by prefixing it with “CONSUMER_” and converting any dots or dashes to underscores. For example tls.ca-certificate becomes CONSUMER_TLS_CA_CERTIFICATE.</p>

<p>Note: In order for TLS to be used, the various TLS options need to be set, but each service URL must also include the appropriate protocol (e.g. FeatureBase hosts should look like “https://featurebase0.local:10101”).</p>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>pilosa-hosts</td>
      <td>strings</td>
      <td>Alias for –featurebase-hosts. Will be deprecated in the next major release.</td>
    </tr>
    <tr>
      <td>featurebase-hosts</td>
      <td>strings</td>
      <td>Comma separated list of host:port pairs for FeatureBase. (Default: localhost:10101)</td>
    </tr>
    <tr>
      <td>kafka-hosts</td>
      <td>strings</td>
      <td>Comma separated list of host:port pairs</td>
    </tr>
    <tr>
      <td>registry-url</td>
      <td>string</td>
      <td>Location of confluent schema registry</td>
    </tr>
    <tr>
      <td>batch-size</td>
      <td>int</td>
      <td>Batch size for FeatureBase ingest. Latency/throughput/memory tradeoff.</td>
    </tr>
    <tr>
      <td>group</td>
      <td>string</td>
      <td>Kafka group.</td>
    </tr>
    <tr>
      <td>index</td>
      <td>string</td>
      <td>FeatureBase index.</td>
    </tr>
    <tr>
      <td>topics</td>
      <td>strings</td>
      <td>Comma separated list of topics.</td>
    </tr>
    <tr>
      <td>log-path</td>
      <td>string</td>
      <td>File to write logs to — defaults to stderr.</td>
    </tr>
    <tr>
      <td>concurrency</td>
      <td>int</td>
      <td>Number of concurrent Kafka readers and indexing routines to launch. max-msgs will be read by each.</td>
    </tr>
    <tr>
      <td>id-field</td>
      <td>string</td>
      <td>Field name which contains the FeatureBase record ID. The field’s value must be an integer and will be used directly as the record ID without translation. For translation, see primary-key-fields.</td>
    </tr>
    <tr>
      <td>primary-key-fields</td>
      <td>strings</td>
      <td>Comma separated list of fields whose values will be concatenated together and translated to the FeatureBase record ID.</td>
    </tr>
    <tr>
      <td>max-msgs</td>
      <td>int</td>
      <td>Maximum number of messages to read from Kafka (useful for debugging). 0 means don’t stop.</td>
    </tr>
    <tr>
      <td>pack-bools</td>
      <td>string</td>
      <td>If non-empty, boolean fields will be packed into two set fields—one with this name, and one with &lt;name&gt;-exists. (default “bools”)</td>
    </tr>
    <tr>
      <td>tls.ca-certificate</td>
      <td>string</td>
      <td>Path to CA certificate file.</td>
    </tr>
    <tr>
      <td>tls.certificate</td>
      <td>string</td>
      <td>Path to certificate file.</td>
    </tr>
    <tr>
      <td>tls.enable-client-verification</td>
      <td>bool</td>
      <td>N/A for Ingester.</td>
    </tr>
    <tr>
      <td>tls.key</td>
      <td>string</td>
      <td>Path to TLS key file.</td>
    </tr>
    <tr>
      <td>tls.skip-verify</td>
      <td>bool</td>
      <td>Skip verification of server certs.</td>
    </tr>
    <tr>
      <td>verbose</td>
      <td>bool</td>
      <td>Enable verbose logging.</td>
    </tr>
    <tr>
      <td>auth-token</td>
      <td>string</td>
      <td>JWT authentication token obtained by following these <a href="/how-tos/enable-auth#how-to-get-auth-token">instructions</a></td>
    </tr>
  </tbody>
</table>

<h2 id="kafka-delete-ingester">Kafka Delete Ingester</h2>

<p>The Kafka delete ingester configuration is the same as the Kafka ingester with the addition of <code class="language-plaintext highlighter-rouge">pilosa-grpc-hosts</code> (or <code class="language-plaintext highlighter-rouge">featurebase-grpc-hosts</code> with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a>) which is the endpoint on which FeatureBase is listening for GRPC connections. This is necessary as the delete ingester uses an <code class="language-plaintext highlighter-rouge">Inspect</code> call to figure out what values need to be deleted and that call is only available over this interface. By default it’s <code class="language-plaintext highlighter-rouge">localhost:20101</code>.</p>

<h2 id="kafka-static-ingester">Kafka Static Ingester</h2>

<p>The Kafka static ingester configuration is the same as the Kafka ingester, except for:</p>

<ul>
  <li>Removal of <code class="language-plaintext highlighter-rouge">registry-url</code>,</li>
  <li>Addition of <code class="language-plaintext highlighter-rouge">header</code> which is a path to a schema definition (or “header”) file in JSON format,</li>
  <li>Addition of <code class="language-plaintext highlighter-rouge">allow-missing-fields</code>.</li>
</ul>

<p>The header file is formatted as an array of objects, each of which describes one ingester field:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="w">
		</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the name of the destination field in FeatureBase"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"the location within the JSON blob to locate the value of this field"</span><span class="p">],</span><span class="w">
		</span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"example"</span><span class="p">:</span><span class="w"> </span><span class="s2">"An optional parameter for a field type."</span><span class="w">
		</span><span class="p">}</span><span class="w">
	</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Type</th>
      <th>Descriptions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>header</td>
      <td>string</td>
      <td>Path to the static schema, in JSON header format.</td>
    </tr>
    <tr>
      <td>allow-missing-fields</td>
      <td>bool</td>
      <td>Will proceed with ingest even if a field is missing from a record but specified in the JSON config file.</td>
    </tr>
  </tbody>
</table>

<h3 id="value-path-selection">Value Path Selection</h3>

<p>The path option is an array of JSON object keys which are applied in order.
For example, <code class="language-plaintext highlighter-rouge">["a","b","c"]</code> would select <code class="language-plaintext highlighter-rouge">1</code> within <code class="language-plaintext highlighter-rouge">{"a":{"b":{"c":1}}}</code>.
This path must only consist of strings - array indexing is not supported. If a value is missing, the ingester will return an error. To override this behavior for non-primary key fields, use <code class="language-plaintext highlighter-rouge">allow-missing-fields</code>.</p>

<h3 id="types">Types</h3>

<p>The available values for <code class="language-plaintext highlighter-rouge">type</code> are:</p>

<table>
  <thead>
    <tr>
      <th><code class="language-plaintext highlighter-rouge">"type":</code></th>
      <th>JSON Input Type</th>
      <th>FeatureBase Field Type</th>
      <th>Config Options</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"id"</code></td>
      <td><code class="language-plaintext highlighter-rouge">10</code></td>
      <td>set/mutex/time</td>
      <td><code class="language-plaintext highlighter-rouge">"Mutex"</code>, <code class="language-plaintext highlighter-rouge">"Quantum"</code>, <code class="language-plaintext highlighter-rouge">"CacheConfig"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"ids"</code></td>
      <td><code class="language-plaintext highlighter-rouge">[1, 2, 3]</code></td>
      <td>set/time</td>
      <td><code class="language-plaintext highlighter-rouge">"Quantum"</code>, <code class="language-plaintext highlighter-rouge">"CacheConfig"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"string"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"example"</code></td>
      <td>keyed set/mutex/time</td>
      <td><code class="language-plaintext highlighter-rouge">"Mutex"</code>, <code class="language-plaintext highlighter-rouge">"Quantum"</code>, <code class="language-plaintext highlighter-rouge">"CacheConfig"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"strings"</code></td>
      <td><code class="language-plaintext highlighter-rouge">["a", "b", "c"]</code></td>
      <td>keyed set/time</td>
      <td><code class="language-plaintext highlighter-rouge">"Mutex"</code>, <code class="language-plaintext highlighter-rouge">"Quantum"</code>, <code class="language-plaintext highlighter-rouge">"CacheConfig"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"bool"</code></td>
      <td><code class="language-plaintext highlighter-rouge">true</code>/<code class="language-plaintext highlighter-rouge">false</code></td>
      <td>packed bool field (row in keyed set fields)</td>
      <td>None</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"int"</code></td>
      <td><code class="language-plaintext highlighter-rouge">10</code>/<code class="language-plaintext highlighter-rouge">-12</code>/<code class="language-plaintext highlighter-rouge">"example"</code></td>
      <td>integer (possibly a foreign-index reference)</td>
      <td><code class="language-plaintext highlighter-rouge">"Min"</code>, <code class="language-plaintext highlighter-rouge">"Max"</code>, <code class="language-plaintext highlighter-rouge">"ForeignIndex"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"decimal"</code></td>
      <td><code class="language-plaintext highlighter-rouge">10.9</code>/<code class="language-plaintext highlighter-rouge">"10.9"</code></td>
      <td>decimal</td>
      <td><code class="language-plaintext highlighter-rouge">"Scale"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"signedIntBoolKey"</code></td>
      <td><code class="language-plaintext highlighter-rouge">10</code>/<code class="language-plaintext highlighter-rouge">-12</code></td>
      <td>same as id, except a negative value clears</td>
      <td>None</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"recordTime"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"2006-01-02T15:04:05Z07:00"</code>/<code class="language-plaintext highlighter-rouge">1273823</code></td>
      <td>applied to id(s)/string(s) (using “Quantum”)</td>
      <td><code class="language-plaintext highlighter-rouge">"Layout"</code>, <code class="language-plaintext highlighter-rouge">"Epoch"</code>,<code class="language-plaintext highlighter-rouge">"Unit"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"dateInt"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"2006-01-02T15:04:05Z07:00"</code>/<code class="language-plaintext highlighter-rouge">1273823</code></td>
      <td>integer timestamp relative to an epoch</td>
      <td><code class="language-plaintext highlighter-rouge">"Layout"</code>, <code class="language-plaintext highlighter-rouge">"Epoch"</code>, <code class="language-plaintext highlighter-rouge">"Unit"</code>, <code class="language-plaintext highlighter-rouge">"CustomUnit"</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"timestamp"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"2006-01-02T15:04:05Z07:00"</code>/<code class="language-plaintext highlighter-rouge">1273823</code></td>
      <td>integer(BSI) timestamp relative to an epoch</td>
      <td><code class="language-plaintext highlighter-rouge">"Granularity"</code>, <code class="language-plaintext highlighter-rouge">"Layout"</code>, <code class="language-plaintext highlighter-rouge">"Epoch"</code>, <code class="language-plaintext highlighter-rouge">"Unit"</code></td>
    </tr>
  </tbody>
</table>

<h3 id="field-configuration-options">Field Configuration Options</h3>

<p>When all config options are left as default, the <code class="language-plaintext highlighter-rouge">"Config"</code> field may be omitted. Otherwise, the config options are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">"Mutex"</code>: if set to <code class="language-plaintext highlighter-rouge">true</code>, the data will be ingested into a mutex field instead of a set field</li>
  <li><code class="language-plaintext highlighter-rouge">"Quantum"</code>: the time quantum selection (e.g. <code class="language-plaintext highlighter-rouge">"YM"</code>/<code class="language-plaintext highlighter-rouge">"YMD"</code>) to use when ingesting into a time field using the time value from a <code class="language-plaintext highlighter-rouge">"recordTime"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"CacheConfig"</code>: the configuration when using a <code class="language-plaintext highlighter-rouge">TopN</code> cache; does not affect time fields</li>
  <li><code class="language-plaintext highlighter-rouge">"Layout"</code>: the format in which to parse time strings (defaults to RFC3339) - specified in <a href="https://golang.org/pkg/time/#pkg-constants">Go’s format</a></li>
  <li><code class="language-plaintext highlighter-rouge">"Min"</code>: the minimum possible value for an acceptable integer (defaults to -2^63)</li>
  <li><code class="language-plaintext highlighter-rouge">"Max"</code>: the maximum possible value for an acceptable integer (defaults to 2^63 - 1)</li>
  <li><code class="language-plaintext highlighter-rouge">"ForeignIndex"</code>: the target index to reference columns of</li>
  <li><code class="language-plaintext highlighter-rouge">"Scale"</code>: the number of digits of precision to store after the decimal point</li>
  <li><code class="language-plaintext highlighter-rouge">"Epoch"</code>: the epoch which timestamps should be relative to. The value may specify a timezone, for example <code class="language-plaintext highlighter-rouge">"1980-11-30T14:20:28.000+07:00"</code>, or use zulu time (i.e. +00:00) <code class="language-plaintext highlighter-rouge">"1980-11-30T14:20:28.000Z"</code>. Defaults to the Unix epoch if not configured.</li>
  <li><code class="language-plaintext highlighter-rouge">"Unit"</code>: the time unit in which to store a timestamp (<code class="language-plaintext highlighter-rouge">dateInt</code>) or the incoming value interpreted as a duration with this <code class="language-plaintext highlighter-rouge">Unit</code>, starting at the configured <code class="language-plaintext highlighter-rouge">Epoch</code> (<code class="language-plaintext highlighter-rouge">recordTime</code>, <code class="language-plaintext highlighter-rouge">timestamp</code>). Can be <code class="language-plaintext highlighter-rouge">"d"</code>, <code class="language-plaintext highlighter-rouge">"h"</code>, <code class="language-plaintext highlighter-rouge">"m"</code>, <code class="language-plaintext highlighter-rouge">"s"</code>, <code class="language-plaintext highlighter-rouge">"ms"</code>, <code class="language-plaintext highlighter-rouge">"us"</code>, <code class="language-plaintext highlighter-rouge">"ns"</code>, for day, hour, minute, second, millisecond, microsecond, nanosecond respectively or <code class="language-plaintext highlighter-rouge">"c"</code> for custom (using <code class="language-plaintext highlighter-rouge">"CustomUnit"</code> for <code class="language-plaintext highlighter-rouge">dateInt</code>). Defaults to <code class="language-plaintext highlighter-rouge">"s"</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">"CustomUnit"</code>: a ‘duration’ value which specifies a custom time unit; accepts values like “6h” for 6 hours, “1m30s” for 1 minute and 30 seconds; valid units can be described using “ns”, “us”, “ms”, “s”, “m”, or “h”</li>
  <li><code class="language-plaintext highlighter-rouge">"Granularity"</code>: the resolution at which the incoming values will be stored. Allowed values are <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ns</code>. Defaults to <code class="language-plaintext highlighter-rouge">"s"</code>.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">"CacheConfig"</code> option specifies the size and type of a <a href="/reference/pql#topn"><code class="language-plaintext highlighter-rouge">TopN</code></a> cache for a set or mutex field.
This “cache” is used for the <code class="language-plaintext highlighter-rouge">TopN</code> approximation.
The default setting is:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="nl">"CacheType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ranked"</span><span class="p">,</span><span class="w">
	</span><span class="nl">"CacheSize"</span><span class="p">:</span><span class="w"> </span><span class="mi">50000</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>When using the <code class="language-plaintext highlighter-rouge">"ranked"</code> cache type, increasing the “cache” size will increase the number of top rows tracked within a shard of data (theoretically improving precision).
Assuming that the cache is full (the field has more than <code class="language-plaintext highlighter-rouge">"CacheSize"</code> rows within each shard), the <code class="language-plaintext highlighter-rouge">TopN</code> cache’s memory usage is jointly proportional to the cache size and number of shards.</p>

<p>This cache can also be disabled by setting the type to <code class="language-plaintext highlighter-rouge">"none"</code>.
Disabling the <code class="language-plaintext highlighter-rouge">TopN</code> cache will prevent <code class="language-plaintext highlighter-rouge">TopN</code> from working.
When operating on a field without a cache, a slower <a href="/reference/pql#topk"><code class="language-plaintext highlighter-rouge">TopK</code></a> or sorted <a href="/reference/pql#groupby"><code class="language-plaintext highlighter-rouge">GroupBy</code></a> query may be used instead.</p>

<p>For <code class="language-plaintext highlighter-rouge">"recordTime"</code> fields, there are essentially two modes. If <code class="language-plaintext highlighter-rouge">"Epoch"</code> or <code class="language-plaintext highlighter-rouge">"Unit"</code> are set, then the incoming data is interpreted as a number. Otherwise it’s assumed that the incoming data is interpreted as a date/timestamp and the <code class="language-plaintext highlighter-rouge">"Layout"</code> is used to parse that value.</p>

<h2 id="csv-ingester">CSV Ingester</h2>

<p>The CSV ingester can read CSV files (optionally gzipped) and ingest them to FeatureBase. It uses a naming convention in the header of the CSV file to <a href="/reference/ingester-configuration#header-descriptions">specify how each field</a> should be ingested. The header can either be included in the file or passed in separately if editing the file is not desirable. If passed in separately one should use the <code class="language-plaintext highlighter-rouge">--ignore-header</code> option if the CSV file has a header so that it is not interpreted as data.</p>

<p>Use <code class="language-plaintext highlighter-rouge">molecula-consumer-csv -h</code> to list all available flags. Each flag is also available as an environment variable by prefixing it with “CONSUMER_”.</p>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>files</td>
      <td>strings</td>
      <td>List of files, URLs, or directories to ingest.</td>
    </tr>
    <tr>
      <td>header</td>
      <td>strings</td>
      <td>Optional header. If not passed, first line of each file is used.</td>
    </tr>
    <tr>
      <td>ignore-header</td>
      <td>bool</td>
      <td>Ignore header in file and use configured header. You <em>must</em> configure a header.</td>
    </tr>
    <tr>
      <td>just-do-it</td>
      <td>bool</td>
      <td>Any header field not in the appropriate format, just downcase, use it as the name and process the value as a String/set field</td>
    </tr>
  </tbody>
</table>

<h3 id="missing-values">Missing Values</h3>

<p>Missing values and empty string values (<code class="language-plaintext highlighter-rouge">""</code>) are handled identically.</p>

<table>
  <thead>
    <tr>
      <th>Field Type</th>
      <th>Expected Behavior	During CSV Ingestion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"ID"</code></td>
      <td>Raise error during ingestion if <code class="language-plaintext highlighter-rouge">"ID"</code> is selected for primary-key-field. Otherwise, behave same as <code class="language-plaintext highlighter-rouge">"String"</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"DateInt"</code></td>
      <td>Raise error during ingestion - timestamp must have a valid value.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"Timestamp"</code></td>
      <td>Raise error during ingestion - input is not time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"RecordTime"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"Int"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"Decimal"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"String"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"Bool"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"StringArray"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"IDArray"</code></td>
      <td>Do not update value in index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">"ForeignKey"</code></td>
      <td>Do not update value in index.</td>
    </tr>
  </tbody>
</table>

<h2 id="sql-ingester">SQL Ingester</h2>

<p>The SQL ingester uses a sql connection (via MSSQL, MySQL, or Postgres) to select data from a sql endpoint, and ingests the data into Molecula. It uses the SQL table column names as <a href="/reference/ingester-configuration#header-descriptions">header descriptions to specify how each field</a> should be ingested, similar to the CSV Ingester.</p>

<p>Use <code class="language-plaintext highlighter-rouge">molecula-consumer-sql -h</code> to list all available flags (or see table below). A few sample configurations are noted below:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
	<span class="nt">--connection-string</span> <span class="s1">'server=sqldb.myserver.com;userid=mysqlusername;password=secret;database=mydbname'</span> <span class="se">\</span>
	<span class="nt">--pilosa-hosts</span> 10.0.0.1:10101 <span class="se">\</span>
	<span class="nt">--batch-size</span> 1000000 <span class="se">\</span>
	<span class="nt">--driver</span><span class="o">=</span>mssql <span class="se">\</span>
	<span class="nt">--index</span><span class="o">=</span>myindexname <span class="se">\</span>
	<span class="nt">--id-field</span><span class="o">=</span><span class="nb">id</span> <span class="se">\</span>
	<span class="nt">--row-expr</span> <span class="s1">'SELECT tableID as id__ID, zipcode as zipcode__String limit 10'</span>
</code></pre></div></div>

<p>Or, equivalently, with the <a href="/reference/featurebase-rename"><code class="language-plaintext highlighter-rouge">--future.rename</code> configuration flag</a> configuration flag:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>molecula-consumer-sql <span class="se">\</span>
    <span class="nt">--future</span>.rename <span class="se">\</span>
	<span class="nt">--connection-string</span> <span class="s1">'server=sqldb.myserver.com;userid=mysqlusername;password=secret;database=mydbname'</span> <span class="se">\</span>
	<span class="nt">--featurebase-hosts</span> 10.0.0.1:10101 <span class="se">\</span>
	<span class="nt">--batch-size</span> 1000000 <span class="se">\</span>
	<span class="nt">--driver</span><span class="o">=</span>mssql <span class="se">\</span>
	<span class="nt">--index</span><span class="o">=</span>myindexname <span class="se">\</span>
	<span class="nt">--id-field</span><span class="o">=</span><span class="nb">id</span> <span class="se">\</span>
	<span class="nt">--row-expr</span> <span class="s1">'SELECT tableID as id__ID, zipcode as zipcode__String limit 10'</span>
</code></pre></div></div>

<p>Example connection strings:</p>

<p>MySQL:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--driver</span> mysql <span class="nt">--connection-string</span> <span class="s1">'myusername:password@(10.0.0.1:3306)/mydb'</span>
</code></pre></div></div>
<p>MS SQL:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--driver</span> mssql <span class="nt">--connection-string</span> <span class="s1">'server=sqldb.myserver.com;userid=mysqlusername;password=secret;database=mydbname'</span>
</code></pre></div></div>
<p>Postgres:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--driver</span> postgres <span class="nt">--connection-string</span> <span class="s1">'postgresql://postgres:password@localhost:5432/molecula?sslmode=disable'</span>
</code></pre></div></div>
<p>or</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--driver</span> postgres <span class="nt">--connection-string</span> <span class="s1">'user=postgres password=password host=localhost port=5432 dbname=molecula sslmode=disable'</span>
</code></pre></div></div>

<p>See the following documentation for more details on connection strings:</p>

<p>MySQL: 		https://github.com/go-sql-driver/mysql#dsn-data-source-name</p>

<p>MSSQL: 		https://github.com/denisenkom/go-mssqldb#connection-parameters-and-dsn</p>

<p>postgres:	https://godoc.org/github.com/lib/pq</p>

<table>
  <thead>
    <tr>
      <th>Flag</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>assume-empty-pilosa</td>
      <td>bool</td>
      <td>Alias for –assume-empty-featurebase. Will be deprecated in the next major release.</td>
    </tr>
    <tr>
      <td>assume-empty-featurebase</td>
      <td>bool</td>
      <td>Setting this means that you’re doing an initial bulk ingest which assumes that data does not need to be cleared/unset in FeatureBase. There are various performance enhancements that can be made in this case. For example, for booleans if a false value comes in, we’ll just set the bit in the bools-exists field… we won’t clear it in the bools field.</td>
    </tr>
    <tr>
      <td>auto-generate</td>
      <td>bool</td>
      <td>Automatically generate IDs.</td>
    </tr>
    <tr>
      <td>batch-size</td>
      <td>int</td>
      <td>Number of records to read before indexing all of them at once. Generally, larger means better throughput and more memory usage. 1,048,576 might be a good number. (default 1)</td>
    </tr>
    <tr>
      <td>concurrency</td>
      <td>int</td>
      <td>Number of concurrent sources and indexing routines to launch. (default 1)</td>
    </tr>
    <tr>
      <td>connection-string</td>
      <td>string</td>
      <td>credentials for connecting to sql database (default “postgres://user:password@localhost:5432/defaultindex?sslmode=disable”)</td>
    </tr>
    <tr>
      <td>driver</td>
      <td>string</td>
      <td>key used for finding go sql database driver (default “postgres”)</td>
    </tr>
    <tr>
      <td>exp-split-batch-mode</td>
      <td>bool</td>
      <td>Tell go-pilosa to build bitmaps locally over many batches and import them at the end. Experimental. Does not support int or mutex fields. Don’t use this unless you know what you’re doing.</td>
    </tr>
    <tr>
      <td>id-field</td>
      <td>string</td>
      <td>Field which contains the integer column ID. May not be used in conjunction with primary-key-fields. If both are empty, auto-generated IDs will be used.</td>
    </tr>
    <tr>
      <td>index</td>
      <td>string</td>
      <td>Name of FeatureBase index.</td>
    </tr>
    <tr>
      <td>log-path</td>
      <td>string</td>
      <td>Log file to write to. Empty means stderr.</td>
    </tr>
    <tr>
      <td>pack-bools</td>
      <td>string</td>
      <td>If non-empty, boolean fields will be packed into two set fields—one with this name, and one with &lt;name&gt;-exists. (default “bools”)</td>
    </tr>
    <tr>
      <td>pilosa-hosts</td>
      <td>strings</td>
      <td>Alias for –featurebase-hosts. Will be deprecated in the next major release.</td>
    </tr>
    <tr>
      <td>featurebase-hosts</td>
      <td>strings</td>
      <td>Comma separated list of host:port pairs for FeatureBase. (Default: localhost:10101)</td>
    </tr>
    <tr>
      <td>pprof</td>
      <td>string</td>
      <td>host:port on which to listen for pprof (default “localhost:6062”)</td>
    </tr>
    <tr>
      <td>primary-key-fields</td>
      <td>strings</td>
      <td>Data field(s) which make up the primary key for a ecord. These will be concatenated and translated to a FeatureBase ID. If empty, record key translation will not be used. (default [])</td>
    </tr>
    <tr>
      <td>row-expr</td>
      <td>string</td>
      <td>sql + type description on input</td>
    </tr>
    <tr>
      <td>stats</td>
      <td>string</td>
      <td>host:port on which to host metrics (default “localhost:9093”)</td>
    </tr>
    <tr>
      <td>string-array-separator</td>
      <td>string</td>
      <td>separator used to delineate values in string array (default “,”)</td>
    </tr>
    <tr>
      <td>tls.ca-certificate</td>
      <td>string</td>
      <td>Path to CA certificate file.</td>
    </tr>
    <tr>
      <td>tls.certificate</td>
      <td>string</td>
      <td>Path to certificate file.</td>
    </tr>
    <tr>
      <td>tls.enable-client-verification</td>
      <td>bool</td>
      <td>Enable verification of client certificates.</td>
    </tr>
    <tr>
      <td>tls.key</td>
      <td>string</td>
      <td>Path to certificate key file.</td>
    </tr>
    <tr>
      <td>tls.skip-verify</td>
      <td>bool</td>
      <td>Disables verification of server certificates.</td>
    </tr>
    <tr>
      <td>verbose</td>
      <td>bool</td>
      <td>Enable verbose logging.</td>
    </tr>
    <tr>
      <td>write-csv</td>
      <td>string</td>
      <td>Write data we’re ingesting to a CSV file with the given name.</td>
    </tr>
  </tbody>
</table>

<h2 id="header-descriptions">Header Descriptions</h2>

<p>The <a href="/reference/ingester-configuration#csv-ingester">CSV</a> and <a href="/reference/ingester-configuration#sql-ingester">SQL</a> ingesters use the same syntax for describing how you want the fields in your source data to be ingested into Molecula. The basic structure is</p>

<p><code class="language-plaintext highlighter-rouge">field_name__FieldType_Arg1_Arg2</code></p>

<p>That is, you name each field, and then you specify the field’s type (separated by two underscores), and then any arguments that the field type takes. For example:</p>

<p><code class="language-plaintext highlighter-rouge">age__Int_0_120</code></p>

<p>declares that field is named ‘age’, is expected to be an integer, and be between 0 and 120. In general, all arguments are optional, but they are also positional, so if you want to specify a maximum value for the int field, you must first specify a minimum value.</p>

<p>Here is the full list of field types along with their arguments:</p>

<h3 id="string">String</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">state__String_T_YMD</code></p>

<p>String is for arbitrary string data. The data will be stored in a ‘set’, ‘mutex’, or ‘time’ type field depending on the arguments given, but will always use key translation.</p>

<p>Argument 1 — Mutex: Either ‘T’ or ‘F’. Specifies whether a “mutex” type field should be used  in FeatureBase. If ‘T’, a “mutex” field is used, and any particular record may only have a single value. If ‘F’, a “set” field is used, and a particular record may have multiple values for this field.</p>

<p>Argument 2 — Time Quantum: If this argument is provided, the field will be a “time” field rather than “set” or “mutex”. “time” fields work similarly to “set” fields but each value can have a coarse grained timestamp associated with it. The granularity is controlled by this argument and can be anything from yearly down to hourly. See the <a href="/explanations/data-modeling">FeatureBase Data Model docs</a> for more information about time fields.</p>

<h3 id="id">ID</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">class__ID_T_YMD</code></p>

<p>ID has the same arguments and works the same way as String, but doesn’t use key translation. The values must be parseable into unsigned integers.</p>

<h3 id="bool">Bool</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">is_alive__Bool</code></p>

<p>Bool will either be stored in a “bool” field, or into packed bools fields if that option is enabled and available on the ingester in use. In the case of packed bools, the name of the field becomes the value at which a bit will be set in the “bools” and “bools-exists” fields. The ingester attempts to coerce incoming data to <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code>. Any integer value will be interpreted as <code class="language-plaintext highlighter-rouge">false</code> if 0 and <code class="language-plaintext highlighter-rouge">true</code> otherwise. The strings (in any upper/lower case combination) ‘0’, ‘f’, ‘false’,  and the empty string will be interpreted as <code class="language-plaintext highlighter-rouge">false</code>, and <code class="language-plaintext highlighter-rouge">true</code> otherwise.</p>

<p>No arguments.</p>

<h3 id="int">Int</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">age__Int_1_120</code></p>

<p>Int will be stored in an “int” field in FeatureBase. A string value will be attempted to be parsed as an integer.</p>

<p>Argument 1 — Min: The lower bound on the field’s values.</p>

<p>Argument 2 — Max: The upper bound on the field’s values.</p>

<h3 id="decimal">Decimal</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">cost__Decimal_2</code></p>

<p>Decimal will be stored in a “decimal” field in FeatureBase. Strings will be attempted to be parsed as floats. Note that values will be truncated to the appropriate decimal place, not rounded, so you should round the value as needed before ingesting.</p>

<p>Argument 1 — Scale: The “scale” for the decimal field. Essentially the number of digits after the decimal point that you wish to store. In the example we have a cost, so we use a scale of ‘2’ to track cost in dollars down to the cent.</p>

<h3 id="foreignkey">ForeignKey</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">user_id__ForeignKey_users</code></p>

<p>ForeignKey is used when values of a field refer to records in another table. The foreign table may be using keys or not, and if it is using keys, the foreign key values can be strings, otherwise they should be unsigned integers. Under the hood, this uses an int field, so each record may only have a single value (as opposed to a ‘set’ field where each record may have many values associated).</p>

<p>Argument 1 — The name of the foreign table.</p>

<h3 id="dateint">DateInt</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">modified_day__DateInt_2006-01-02_1970-01-01_C_1d</code></p>

<p>DateInt stores a datetime in an “int” field in FeatureBase. The dates are converted to ints according to the arguments. The integer value stored represents the number of units of time since some ‘epoch’ time.</p>

<p>Argument 1 - Layout: gives an example format for how the date value should be parsed. The default value for layout is ‘2006-01-02T15:04:05Z07:00’. Write this same datetime in whatever format your values have. For example, for a traditional MM/DD/YYYY representation, you would use ‘01/02/2006’ for layout.</p>

<p>Argument 2 - Epoch: The ‘zero’ timestamp from which the int values are calculated. Written using the same layout as specified by argument 1.</p>

<p>Argument 3 - Unit: The time unit to store. If the unit is a day, then a value of 17 means 17 days since the epoch. Unit may be <code class="language-plaintext highlighter-rouge">"d"</code>, <code class="language-plaintext highlighter-rouge">"h"</code>, <code class="language-plaintext highlighter-rouge">"m"</code>, <code class="language-plaintext highlighter-rouge">"s"</code>, <code class="language-plaintext highlighter-rouge">"ms"</code>, <code class="language-plaintext highlighter-rouge">"us"</code>, <code class="language-plaintext highlighter-rouge">"ns"</code> or <code class="language-plaintext highlighter-rouge">"c"</code> for custom. If <code class="language-plaintext highlighter-rouge">"c"</code> is used, argument 4 specifies the customer duration.</p>

<p>Argument 4 - Custom Unit: A ‘duration’ value which specifies a custom time unit. Accepts values like “6h” for 6 hours, “1m30s” for 1 minute and 30 seconds. Valid time units are “ns”, “us”, “ms”, “s”, “m”, “h”.</p>

<h3 id="recordtime">RecordTime</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">time__RecordTime_2006-01-02_2018-03-04_d</code></p>

<p>RecordTime is for a timestamp in a record which applies to the whole record. Any field in the record which will be stored as a ‘time’ field in FeatureBase will have this time associated with its value. Note that using this field type alone will not explicitly create a field in FeatureBase.</p>

<p>Argument 1: Layout: gives an example format for how the date value should be parsed. The default value for layout is ‘2006-01-02T15:04:05Z07:00’. Write this same datetime in whatever format your values have. For example, for a traditional MM/DD/YYYY representation, you would use ‘01/02/2006’ for layout.</p>

<p>Argument 2 - Epoch: The ‘zero’ timestamp from which the int values are calculated. Written using the same layout as specified by argument 1.</p>

<p>Argument 3 - Unit: the incoming value will be interpreted as a duration with this Unit, starting at the configured Epoch. Can be <code class="language-plaintext highlighter-rouge">"d"</code>, <code class="language-plaintext highlighter-rouge">"h"</code>, <code class="language-plaintext highlighter-rouge">"m"</code>, <code class="language-plaintext highlighter-rouge">"s"</code>, <code class="language-plaintext highlighter-rouge">"ms"</code>, <code class="language-plaintext highlighter-rouge">"us"</code>, <code class="language-plaintext highlighter-rouge">"ns"</code>, for day, hour, minute, second, millisecond, microsecond, or nanosecond respectively. Defaults to <code class="language-plaintext highlighter-rouge">"s"</code>.</p>

<h3 id="timestamp">Timestamp</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">purchase_date__Timestamp_s_2006-01-02T15:04:05Z07:00_2018-03-04T15:04:05Z_ms</code></p>

<p>Timestamp fields are implemented internally the same way as integer fields and store the number of time units (e.g. seconds) since an epoch. By default, the time unit is in seconds and the epoch is midnight, January 1, 1970 UTC. Adjusting the granularity and epoch can reduce the storage requirements and computation time when processing records.</p>

<p>Argument 1 - Granularity: the resolution at which the incoming values will be stored. Allowed values are <code class="language-plaintext highlighter-rouge">s</code>, <code class="language-plaintext highlighter-rouge">ms</code>, <code class="language-plaintext highlighter-rouge">us</code>, <code class="language-plaintext highlighter-rouge">ns</code>. Defaults to <code class="language-plaintext highlighter-rouge">"s"</code>.</p>

<p>Argument 2 - Layout: gives an example format for how the date value should be parsed. The default value is RFC3339Nano: ‘2006-01-02T15:04:05.999999999Z07:00’. Write this same datetime in whatever format your values have. Refer to <a href="https://golang.org/pkg/time/#pkg-constants">Go’s format docs</a>.</p>

<p>Argument 3 - Epoch: The ‘zero’ timestamp from which the int values are calculated. Written using the same layout as specified by argument 2.</p>

<p>Argument 4 - Unit: the incoming value will be interpreted as a duration with this Unit, starting at the configured Epoch. Can be <code class="language-plaintext highlighter-rouge">"d"</code>, <code class="language-plaintext highlighter-rouge">"h"</code>, <code class="language-plaintext highlighter-rouge">"m"</code>, <code class="language-plaintext highlighter-rouge">"s"</code>, <code class="language-plaintext highlighter-rouge">"ms"</code>, <code class="language-plaintext highlighter-rouge">"us"</code>, <code class="language-plaintext highlighter-rouge">"ns"</code>, for day, hour, minute, second, millisecond, microsecond, or nanosecond respectively. Defaults to <code class="language-plaintext highlighter-rouge">"s"</code>.</p>

<h3 id="stringarray">StringArray</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">tags__StringArray_</code></p>

<p>StringArray is similar to the <code class="language-plaintext highlighter-rouge">String</code> type, but expects multiple values in a single record. Each value will be set in the corresponding row of the FeatureBase ‘set’ or ‘time’ field. To retrieve Array values from a CSV file, the data within the CSV column should be a comma separated list of array values enclosed in double quotes, e.g. <code class="language-plaintext highlighter-rouge">"Georgia,Texas,Oregon"</code>.</p>

<p>Argument 1 — Time Quantum: If this argument is provided, the field will be a “time” field rather than “set”. “time” fields work similarly to “set” fields but each value can have a coarse grained timestamp associated with it. The granularity is controlled by this argument and can be anything from yearly down to hourly. See the <a href="/explanations/data-modeling">FeatureBase Data Model docs</a> for more information about time fields.</p>

<h3 id="idarray">IDArray</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">links__IDArray_</code></p>

<p>IDArray is similar to the <code class="language-plaintext highlighter-rouge">ID</code> type, but expects multiple values in a single record. Each value will be set in the corresponding row of the FeatureBase ‘set’ or ‘time’  field. To retrieve Array values from a CSV file, the data within the CSV column should be a comma separated list of values enclosed in double quotes, e.g. <code class="language-plaintext highlighter-rouge">"10,23,18"</code>.</p>

<p>Argument 1 — Time Quantum: If this argument is provided, the field will be a “time” field rather than “set”. “time” fields work similarly to “set” fields but each value can have a coarse grained timestamp associated with it. The granularity is controlled by this argument and can be anything from yearly down to hourly. See the <a href="/explanations/data-modeling">FeatureBase Data Model docs</a> for more information about time fields.</p>

<h3 id="ignore">Ignore</h3>
<p>Example:
<code class="language-plaintext highlighter-rouge">uuid__Ignore</code></p>

<p>Ignore the value in this field. If you have values you don’t want to ingest, but it is inconvenient to remove them ahead of time, you can use the Ignore field to explicitly ignore them.</p>

                </section>
            </article>
    
            <!-- Right sidebar -->
            <nav class="container__right">
                <div>Applies to</div>

                <span>Please <a href="https://github.com/molecula/documentation/edit/gh-pages/reference/ingester-configuration.md">help improve this article</a>.</span>

                <div>
                    <span>
                        Modified: 
                    </span>
                </div>

                <div>Feedback?</div>
            </nav>
        </main>
        <footer>
            <p> &copy; 2022 Molecula Corp.</p>
        </footer>
    </div>
  </body>
</html>